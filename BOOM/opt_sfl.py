import os
import sys
import itertools
import math
import numpy as np

from BOOM_system_model.DNN import DNN
from BOOM_system_model.UD import UD
from BOOM_system_model.Edge_Server import Edge_Server


def create_edge_server():
    # 初始化参数
    antenna = 4.11
    phi = 9.15e8
    distance = 100
    PL = 3
    h = antenna * (3e8 / (4 * math.pi * phi * distance)) ** PL  # 信道系数
    AWGN = 1e-10
    B = 2e6  # 带宽

    Fs = [24728090815.834816, 23960151770.883045, 23433337352.881145, 23917014410.95472, 25247244457.1045,
      24917756569.18886, 26035763557.753765, 24703149020.41679, 34148553850.215813, 32254135125.985146,
      32340574641.607105, 31148998807.6443, 28456850574.14386, 28029952373.90314, 27584292868.598507,
      26932449380.507614, 24591878857.023357, 25810569042.064857, 26870172096.82734, 27536988592.57963,
      28504631138.84235, 29826136445.038754, 29647521406.174377, 29627040189.83554, 31873439868.195774,
      30727269797.944237, 27677713756.735725, 27599275701.631863, 27944578962.98006, 28449787711.516727,
      28255228642.985123, 27551805267.6715, 26996960318.724075, 26681929849.524624, 25403178496.838455,
      28054258562.5892, 27605363586.7642, 27094121849.90979, 27813753534.53802, 27356867901.11524,
      28255785858.461727, 30276285056.272312, 30455224030.190563, 30159935732.104958, 28187594229.8007,
      29819437418.74481, 31354449435.604443, 30504984763.797295, 32109297341.260925, 33174833644.174953,
      32165819078.755917, 31790293367.74329, 30608747414.694817, 31725840158.33578, 31274918854.887093,
      29627329463.944687, 29090609824.99905, 30163517657.590336, 30762705626.783024, 28231748983.21773,
      27412047617.250416, 27293314191.550694, 26918657945.995632, 28681504062.2302, 28044050277.226,
      27293108356.23357, 26356546698.573097, 24244808818.54545, 24887897839.365974, 23490046936.822144,
      23520709490.960648, 23262995704.22439, 23843972776.098072, 23833846233.1631, 24227247540.54919,
      26079334065.194885, 27740585439.42679, 28639619671.9044, 29286809142.68806, 29927077326.916004,
      29002484415.782135, 30673370666.195747, 33011001814.68238, 30782407649.68514, 30091199338.00271,
      33840897600.594246, 31657892334.050465, 32219032017.632584, 31352590964.152584, 31881694061.743465,
      32522541363.705914, 31018342960.885956, 31867328882.804436, 30514568351.21915, 29287319259.36223,
      25793732271.881634, 26677045354.79364, 28551019979.537632, 31396542504.117348, 30136218174.87129,
      30562916869.656364, 26765142245.14122, 30132881778.34692, 29693358473.009487, 28851188810.2651,
      29583725964.921143, 28850234972.08391, 28684903526.269894, 26074815626.059155, 25581118572.81742,
      25113704723.32915, 28751413796.438946, 29268898121.308884, 28265477854.5945, 25421926646.04343,
      23946738159.470478, 25397208115.339165, 24037577253.834145, 24323805459.683895, 23541573924.15526,
      23395646063.344685, 25643134971.866093, 24427441270.948223, 26254906334.015446, 24199435209.239197,
      22996792359.02444, 23488063858.984356, 24343679788.693024, 25745811750.80002, 26073210057.400143,
      27314605236.137024, 27222672137.33662, 28207895013.45587, 25912138618.01754, 25871346697.862774,
      25455576690.72111, 27012790467.54252, 27916694348.305653, 25914773014.127346, 24612878091.82643,
      24347926849.867966, 24749263953.3984, 27164297988.081436, 26575520409.143135, 27466573300.99237,
      27486758913.218708, 25879501541.796055, 25787981406.754967, 25172512107.999657, 23076177811.20476,
      24137667697.81335, 23932772965.953804, 24703804545.470066, 24430774051.511517, 24132253424.41448,
      23113835450.475956, 25894772155.607784, 23863854102.812817, 22387093189.497345, 21262951799.927567,
      22024024553.019028, 22941314202.08536, 24029818435.31047, 23489227577.775005, 24518454322.894363,
      23372269090.475746, 24362916864.437042, 24837066255.252888, 25504476966.30511, 27988607953.169422,
      27637878075.318325, 28721567930.76212, 27407216757.404526, 27172575954.78451, 26947358024.510468,
      26847223229.94962, 25745297219.146538, 26205269694.84683, 26932497320.68027, 27615089755.37588,
      28353689720.861565, 26920468887.885105, 27292659773.55236, 26517627639.913326, 28621827842.52163,
      29657229015.823154, 30269268402.76877, 29212872082.374847, 27032926859.573864, 30293843452.7764,
      30622094464.09197, 28900947810.74923, 28640422128.95096, 28840797669.042324, 26687063021.062157,
      25825333032.613903, 26489453440.83908, 26709980935.151943, 29514099337.39009, 28326075508.32625,
      28447309513.802578, 29979222209.614326, 27742806799.486416, 29815288023.050274, 26881400977.40094,
      27215355675.749454, 27257990562.215652, 28886029310.037918, 29745824379.39173, 30272601393.379364,
      29189173454.145473, 30018823333.675552, 31986066018.768143, 31383352764.855404, 29457338392.471294,
      29500010531.582474, 26064744088.758495, 27414037821.89061, 26718390535.790028, 27170400289.77755]
    Ps = [0.9976922448091735, 1.027475930627835, 1.02833802543656, 1.0067888322302854, 1.0217159557726483,
          1.0129132853419482, 1.0146608955246608, 0.9982369714593651, 0.9928709879413347, 0.991489149334256,
          1.001888361574992, 1.0071492347175341, 1.0075557195169957, 1.0027114655655531, 1.0132445823445464,
          1.012468325759839, 1.0363808694066192, 1.0209604115166766, 1.013021963927971, 1.0091146882134252,
          1.0265561780150285, 1.0355038997763193, 1.0242632457065095, 1.030876868962675, 1.0181021034935445,
          1.0342459465598026, 1.0519655723157157, 1.064978060647922, 1.0661463120796824, 1.0618730692407152,
          1.060218412261172, 1.0871136414218125, 1.0772510125597556, 1.0633691227867346, 1.0782767612511521,
          1.0818916577655027, 1.0789233821739836, 1.0553025094024562, 1.0527147443261138, 1.058024367065827,
          1.0608425336180864, 1.0467686418660427, 1.0546296811721774, 1.0408382181492648, 1.031706014937925,
          1.0354233828380468, 1.0490706136567207, 1.031315989842697, 1.0193152487569574, 1.0400845537391674,
          1.0123731493008956, 1.010890153098169, 0.9987666683369709, 1.0066185321481944, 1.0232144718448632,
          1.032553326609256, 1.0135531652229477, 1.0202223364479246, 1.0032240943045163, 1.017716595408675,
          1.0000290469054023, 0.9819440577484192, 0.9700389313298123, 0.9705857303423372, 0.9785201663353954,
          0.9960886712357714, 1.0155936183558474, 1.0078877817035532, 0.9976632173642027, 0.9971355286680631,
          0.9923380108213589, 0.9851598338660648, 1.0050335162717634, 0.9919148021255404, 0.9872773378770653,
          0.9987634292632789, 0.996037888863551, 1.0012500131636122, 0.999130768922483, 0.9948287403611218,
          1.0063437817796896, 0.9999988065525361, 1.0185625769322022, 1.0277146575627707, 1.0335628397207177,
          1.0373955720507686, 0.9936048629612831, 1.0089356642276286, 1.0047995673911718, 1.004370543346505,
          0.9902282747567854, 0.984616756092963, 0.9642309917929214, 0.9698469527347141, 0.9810525467770256,
          0.9936007354300118, 1.0037604431780316, 0.9915801577558078, 0.978204721604849, 1.0010176593730986,
          0.9991879372834345, 1.0096187841084077, 0.9986595149089937, 1.0106706996568344, 1.003262072354985,
          1.004260365400509, 1.0200568555819116, 1.02604983647047, 1.0180885401848212, 1.02846078761791,
          1.0373534059018898, 1.044625440676845, 1.018526490208656, 0.9994715353835358, 1.0028372645771582,
          1.0098685003761052, 1.0094613081964245, 1.001898050492676, 1.024220171874484, 1.0127356456807608,
          1.0290105090480826, 1.0368431139838663, 1.0337033376338685, 1.038586365584237, 1.0210773305858913,
          1.0063018618085309, 1.0077557289284342, 0.9937563147760597, 1.0049904725175511, 1.0106507202156485,
          1.0332289977875992, 1.0317924699179326, 1.0274368492859403, 1.021169439860382, 1.0205769780097433,
          1.0327721366687528, 1.037905053456367, 1.0318116136412645, 1.0238649361270389, 1.0320456080941591,
          1.0221351907767064, 1.0223224111776388, 1.0390423466228402, 1.0306428572537074, 1.0273169906142332,
          1.0376557370839863, 1.0366294955805189, 1.0361265012155658, 1.0217178553083226, 1.0210419951998766,
          1.01733291062894, 1.0184598933109446, 1.0403658488243868, 1.0405117874255538, 1.0335183792724152,
          1.0331874482769479, 1.048352019165147, 1.0332066486309928, 1.0341720624941129, 1.0300107854632146,
          1.0482856061044121, 1.0287381287963293, 1.0278569227190852, 1.01166382817883, 1.020397478500615,
          1.0485626812562183, 1.0370316124694292, 1.0206323350200959, 1.0212568426991002, 1.005272216373121,
          0.9967251968337187, 1.0089273196042239, 1.0011068820948064, 1.0190253898073103, 1.0067151663219902,
          0.9967336405167372, 1.0021115754652654, 1.0122442630365107, 1.0297206673490067, 1.029181400419129,
          1.0468161990571012, 1.020921912547713, 1.0386040080699142, 1.0511024445926809, 1.057467144309237,
          1.041907839716885, 1.044814518790495, 1.0394178438095223, 1.0520720568608046, 1.0462246386254717,
          1.0441953361283298, 1.0429128244123955, 1.0145803787974377, 0.9979810541561234, 0.9926493744311417,
          1.0042522875042943, 1.0112977374128513, 1.004447943194643, 0.9960710837876924, 1.01211643952307,
          1.026898739501383, 1.0216378220070195, 1.0001817455348516, 1.0070119095451644, 0.9810747889313232,
          0.9987731811051043, 0.984772084380581, 0.9695732343670584, 0.966659690553598, 0.9909537027909878,
          0.988354668212952, 1.0064570511109159, 1.0158691769967045, 1.0217657665619804, 1.0187804652474124,
          1.012827871467107, 1.0239694199221643, 1.02916182250959, 1.0209609437782396, 1.0275655428669799]


    UDs = []
    UDs.append(UD(0, f=1.2e8, p=0.08, cores=8, cpi=2, h=h, s=3, k=1e-26))
    UDs.append(UD(1, f=0.8e8, p=0.05, cores=4, cpi=1, h=h, s=3, k=1e-26))
    UDs.append(UD(2, f=0.9e8, p=0.09, cores=8, cpi=2, h=h, s=3, k=1e-26))
    UDs.append(UD(3, f=0.6e8, p=0.03, cores=4, cpi=1, h=h, s=3, k=1e-26))
    UDs.append(UD(4, f=0.6e8, p=0.08, cores=4, cpi=1, h=h, s=3, k=1e-26))
    UDs.append(UD(5, f=0.6e8, p=0.08, cores=4, cpi=1, h=h, s=3, k=1e-26))
    UDs.append(UD(6, f=0.6e8, p=0.08, cores=4, cpi=1, h=h, s=3, k=1e-26))
    UDs.append(UD(7, f=0.6e8, p=0.08, cores=4, cpi=1, h=h, s=3, k=1e-26))
    UDs.append(UD(8, f=0.6e8, p=0.08, cores=4, cpi=1, h=h, s=3, k=1e-26))
    UDs.append(UD(9, f=0.6e8, p=0.08, cores=4, cpi=1, h=h, s=3, k=1e-26))

    
    
    # 创建 Edge_Server 实例
    edge_training = Edge_Server(UDs, DNN('resnet34'), B, AWGN, Fs, Ps)
    
    return edge_training
